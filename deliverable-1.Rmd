---
title: "deliverable-1"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Loading data
Cargamos los datos guardados en el fichero set-Datos.RData. En este fichero hay la muestra de 5000 individuos que se usará para el análisis. Podemos comprobar que la dimensión de los datos es correcto, 5000 filas y 21 columnas.

```{r}

#setwd("C:/Users/Sergio/Dropbox/UPC/FIB/Analisis de datos y explotacion de la informacion (ADEI)/FIB-ADEI-Big-Data-Analysis")
#setwd("C:/Users/GUILLEM/Documents/ADEI/FIB-ADEI-Big-Data-Analysis")
setwd("C:/Users/usuario/Documents/ADEI/FIB-ADEI-Big-Data-Analysis")


load("set-datos.RData", envir = parent.frame(), verbose = FALSE)

#Comprobar el tamaño de la muestra
dim(df)
```

# Exploratory Data Analysis


```{r}
# Graphics
names(df)
# Overview of data frame 
summary(df)


#######################GUILLEM:
#Separamos variables target/no-target numéricas/categóricas (observamos un individuo cualquiera)
df[1,]
aux <- c(1,11:14,16:20)
vars_num<-names(df)[aux];vars_num
vars_cat<-names(df)[-aux];vars_cat
vars_target<-names(df)[c(11,21)];vars_target
#Analizamos variables según si son cat/num o target/no-target (obtenemos 4 clasificaciones)
#target+categorica (miramos qué nivles tiene)
levels(df$y) #solo hay yes/no no hay que hacer nada

#target+numerica (miramos qué valores toma)
summary(df$duration)#Vemos que hay valores muy pequeños, incluso 0, tambien de muy grandes.
hist(df$duration,100) #Miramos distribución
boxplot(df$duration) #Hacemos boxplot para ver outliers
calcQ <- function(x) {# Some useful functions
  s.x <- summary(x)
  iqr<-s.x[5]-s.x[2]
  list(souti=s.x[2]-3*iqr, mouti=s.x[2]-1.5*iqr, min=s.x[1], q1=s.x[2], q2=s.x[3], 
       q3=s.x[5], max=s.x[6], mouts=s.x[5]+1.5*iqr, souts=s.x[5]+3*iqr ) }
out.var<-calcQ(df$duration);out.var
abline(h=650,col="red",lwd=2) #Fijamos límite soft
abline(h=979,col="magenta",lwd=2) #Fijamos límite extreme
aux<-order(df$duration,decreasing=TRUE)[1:10];df[aux,'duration'] #Hechamos un ojo a los 10 valores más extremos
df<-df[-aux[1:6],]#decidimos eliminamos los 6 elementos más extremos 
boxplot(df$duration) #Hacemos boxplot de nuevo
aux<-which(df$duration<5);length(aux);df[aux,'duration']#Ahora miramos los que son inferiores a 5s (no puede considerarse llamada)
df<-df[-aux,]#decidimos eliminamos todos

#no-target+categorica
#no-target+numerica

#######################FI GUILLEM#####################3
#eliminamos las filas con NA's en las variables target (Duration & Y)
sel<-which(is.na(df$duration));sel
# si sel es igual a cero, no hacemos esta linea
# df<-df[-sel,]

sel<-which(is.na(df$y));sel
# si sel es igual a cero, no hacemos esta linea
# df<-df[-sel,]

# Missing values de las variables no target, y hacerle imputación
miss_row<-rowSums(is.na(df))
miss_col<-colSums(is.na(df))
miss_col

# age no consideramos ningún outlier
# job
sel<-which(df$job=="unknown");sel
df$job[sel]<-NA
summary(df$job)
df$job<-factor(df$job)

# marital
sel<-which(df$marital=="unknown");sel
df$marital[sel]<-NA
summary(df$marital)
df$marital<-factor(df$marital)

# education
sel<-which(df$education=="unknown");sel
df$education[sel]<-NA
summary(df$education)
df$education<-factor(df$education)


# default (Hay demasiados unkown, vale la pena imputar? ) 
sel<-which(df$default=="unknown");sel
df$default[sel]<-NA
summary(df$default)
df$default<-factor(df$default)

# housing
sel<-which(df$housing=="unknown");sel
df$housing[sel]<-NA
summary(df$housing)
df$housing<-factor(df$housing)

# loan
sel<-which(df$loan=="unknown");sel
df$loan[sel]<-NA
summary(df$loan)
df$loan<-factor(df$loan)

# contact (No hay uknows)

# month (No hay uknows)

# day_of_week (No hay uknows)

# campaign (No hay uknows)

# pdays (No hay uknows pero estan los 999)

# previous (No hay uknows)

# poutcome (No hay uknows)

# emp.var.rate (No hay uknows)

# cons.price.idx (No hay uknows)

# cons.conf.idx (No hay uknows)

# euribor3m (No hay uknows)

# nr.employed (No hay uknows)

# Eliminamos los outliers que pueden ser NA's

sel<-which(df$duration>3600);length(sel);sel
df<-df[-sel,]

# Outliers univariants podeu detectar-los i marcar-los com NA


# Errors: set to NA. Ex: Duration<=0
ll<-which(df$duration<=0);ll
df$duration[ll]<-NA

```

# Revisión de cada variable con summary y boxplots

```{r}

# age
summary(df$age)
hist(df$age,col="cyan",main="age - Histogram")
boxplot(df$age, labels=row.names(df))

# job
summary(df$job)

# marital
summary(df$marital)

# education
summary(df$education)

# default
summary(df$default)

# housing
summary(df$housing)

# loan
summary(df$loan)

# contact
summary(df$contact)

# month
summary(df$month)

# day_of_week
summary(df$day_of_week)

# duration
summary(df$duration)
hist(df$duration,col="cyan",main="duration - Histogram")
boxplot(df$duration, labels=row.names(df))

# campaign
summary(df$campaign)
sum(is.na(df$campaign))
hist(df$campaign,col="cyan",main="campaign - Histogram")
boxplot(df$campaign, labels=row.names(df))

# pdays
summary(df$pdays)
sum(is.na(df$pdays))
hist(df$pdays,col="cyan",main="pdays - Histogram")
boxplot(df$pdays, labels=row.names(df))

# previous
summary(df$previous)
sum(is.na(df$previous))
hist(df$previous,col="cyan",main="previous - Histogram")
boxplot(df$previous, labels=row.names(df))

# poutcome
summary(df$poutcome)

# emp.var.rate
summary(df$emp.var.rate)
sum(is.na(df$emp.var.rate))
hist(df$emp.var.rate,col="cyan",main="emp.var.rate - Histogram")
boxplot(df$emp.var.rate, labels=row.names(df))

# cons.price.idx
summary(df$cons.price.idx)
sum(is.na(df$cons.price.idx))
hist(df$cons.price.idx,col="cyan",main="cons.price.idx - Histogram")
boxplot(df$cons.price.idx, labels=row.names(df))

# cons.conf.idx
summary(df$cons.conf.idx)
sum(is.na(df$cons.conf.idx))
hist(df$cons.conf.idx,col="cyan",main="cons.conf.idx - Histogram")
boxplot(df$cons.conf.idx, labels=row.names(df))

# euribor3m
summary(df$euribor3m)
sum(is.na(df$euribor3m))
hist(df$euribor3m,col="cyan",main="euribor3m - Histogram")
boxplot(df$euribor3m, labels=row.names(df))

# nr.employed
summary(df$nr.employed)
sum(is.na(df$nr.employed))
hist(df$nr.employed,col="cyan",main="nr.employed - Histogram")
boxplot(df$nr.employed, labels=row.names(df))

# y
summary(df$y)
```

# crear lista de cuantitativos y cualitativos

```{r}
listaCualitativo<-list(df$job, df$marital, df$education, df$default, df$housing, df$loan, df$contact, df$month, df$day_of_week, df$poutcome, df$y)
names(listaCualitativo)<-c("job", "marital", "education", "default", "housing", "loan", "contact", "month", "day_of_week", "poutcome", "y")
listaCuantitativo<-list(df$age, df$duration, df$campaign, df$pdays, df$previous, df$emp.var.rate, df$cons.price.idx, df$cons.conf.idx, df$euribor3m, df$nr.employed)
names(listaCuantitativo)<-c("age", "duration", "campaign", "pdays", "previous", "emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m", "nr.employed")
```

# missing values de las variables target

# missing values 

# missing values de outliers


# Crear factores adicionales para cada variable cuantitativa
```{r}
# Para Age
qulist<-quantile(df$age,seq(0,1,0.25),na.rm=TRUE)

varaux<-factor(cut(df$age,breaks=qulist,include.lowest=T))
table(varaux)
tapply(df$age,varaux,median)
varaux<-factor(cut(df$age,breaks=c(18,30,40,50,92),include.lowest=T))
table(varaux)
tapply(df$age,varaux,median)

df$f.age<-factor(cut(df$age,breaks=c(18,30,40,50,92),include.lowest=T))

summary(df$f.age)
levels(df$f.age)<-paste0("f.age-",levels(df$f.age))

# Para duration
qulist<-quantile(df$duration,seq(0,1,0.25),na.rm=TRUE)

varaux<-factor(cut(df$duration,breaks=qulist,include.lowest=T))
table(varaux)
tapply(df$duration,varaux,median)
varaux<-factor(cut(df$duration,breaks=c(18,30,40,50,92),include.lowest=T))
table(varaux)
tapply(df$duration,varaux,median)

df$f.duration<-factor(cut(df$age,breaks=c(18,30,40,50,92),include.lowest=T))

summary(df$f.age)
levels(df$f.age)<-paste0("f.age-",levels(df$f.age))

```
